{"id":185,"date":"2017-06-05T09:00:08","date_gmt":"2017-06-05T13:00:08","guid":{"rendered":"http:\/\/langstonsoftware.com\/?p=185"},"modified":"2024-01-30T19:09:16","modified_gmt":"2024-01-31T00:09:16","slug":"automatic-versioning-of-csharp-mvc-applications","status":"publish","type":"post","link":"https:\/\/langstonsoftware.com\/2017\/06\/05\/automatic-versioning-of-csharp-mvc-applications\/","title":{"rendered":"Automatic Versioning of C# MVC Applications"},"content":{"rendered":"<p>I recently had a project that had me delving into the following blog post on assembly versioning: <a href=\"https:\/\/blogs.msdn.microsoft.com\/jjameson\/2009\/04\/03\/best-practices-for-net-assembly-versioning\/\" target=\"_blank\" rel=\"noopener\">https:\/\/blogs.msdn.microsoft.com\/jjameson\/2009\/04\/03\/best-practices-for-net-assembly-versioning\/<\/a><\/p>\n<p>The blog post had a couple of problems. The first that came to mind was that the linked examples were using Team Foundation Server, while I was using Atlassian Bamboo. The second is that it seemed like a lot of work, especially when dealing with a large number of existing projects in a legacy solution all churning version numbers. Jumping back into Google I found a new blog post: <a href=\"https:\/\/blogs.msdn.microsoft.com\/jjameson\/2009\/04\/03\/shared-assembly-info-in-visual-studio-projects\/\" target=\"_blank\" rel=\"noopener\">https:\/\/blogs.msdn.microsoft.com\/jjameson\/2009\/04\/03\/shared-assembly-info-in-visual-studio-projects\/<\/a><\/p>\n<p>This seemed better, but I was not sure that putting all the assembly version information into one shared file is correct either. It seems like we&#8217;d be doing fine keeping our dlls at the default 1.0.0.0 version, I just wanted to tag the dlls with our Git commit SHA.  Otherwise our repo would churn on build. Also, I&#8217;d prefer to do a full replace during my build on a file that only contains the information I want to change across my entire repo, leaving the rest alone. So I decided that modifying the AssemblyInformationalVersion in a CI script made the most sense for what I was trying to accomplish.<\/p>\n<p>I searched further and found the <a href=\"https:\/\/github.com\/loresoft\/msbuildtasks\" target=\"_blank\" rel=\"noopener\">MSBuild Community Tasks<\/a> repo. However, I prefer PowerShell to MSBuild target XML &#8220;programming&#8221;.<\/p>\n<p>Example below is using Bamboo build environment variables, but can easily be tailored to your CI build system. For those who know Bamboo, you might notice the <a href=\"https:\/\/stackoverflow.com\/questions\/15987684\/are-bamboo-variables-automatically-available-as-environment-variables\" target=\"_blank\" rel=\"noopener\">Bamboo variables look a little different in PowerShell<\/a>. For those new to Powershell, I&#8217;m using the backtick (`) as the string escape character.<\/p>\n<pre class=\"brush: powershell; title: ; notranslate\" title=\"\">$revision = $Env:bamboo_planRepository_revision\r\n$buildNumber = $Env:bamboo_buildNumber\r\n$text = &quot;$revision - $buildNumber&quot;\r\n$text &gt; 'Version.txt'\r\n\r\n$assemblyText = &quot;using System.Reflection;`n&#x5B;assembly: AssemblyInformationalVersion(`&quot;$text`&quot;)]&quot; \r\n\r\n$assemblyText &gt; 'SharedAssemblyInfo.cs'<\/pre>\n<p>You can add the Version.txt file as an ignored route in MVC if you&#8217;d like it to be served by ASP.NET. I created two dummy files in the top of my repo that whose contents would be replaced by this script. I <a href=\"https:\/\/blogs.msdn.microsoft.com\/jjameson\/2009\/04\/02\/linked-files-in-visual-studio-solutions\/\" target=\"_blank\" rel=\"noopener\">included these shared files in all the projects by linking to them<\/a>. I did move my dummy SharedAssemblyInfo.cs file into the Properties folder of my projects so it could sit side-by-side with the default AssemblyInfo.cs file. Now I can either look at Version.txt from a browser, or right click the dll directly on the machine to see the &#8220;Product Version&#8221; under the Details tab of the Properties modal.<\/p>\n<h3>Before You Go<\/h3>\r\n&nbsp;<p>\r\nWas this post was incorrect or incomplete?  Leave a comment.\r\n<\/p>\r\n<style>\r\n#callToAction {color:red}\r\n<\/style>\r\n<p>\r\nWas this post helpful to you? <a id=\"callToAction\" class=\"button\" href=\"http:\/\/eepurl.com\/bYVEJj\"><em>Subscribe for emails on full stack web development.<\/em><\/a>\r\n<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I recently had a project that had me delving into the following blog post on assembly versioning: https:\/\/blogs.msdn.microsoft.com\/jjameson\/2009\/04\/03\/best-practices-for-net-assembly-versioning\/ The blog post had a couple of problems. The first that came to mind was that the linked examples were using Team Foundation Server, while I was using Atlassian Bamboo. The second is that it seemed like &#8230;<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"nf_dc_page":"","jetpack_post_was_ever_published":false,"_jetpack_newsletter_access":"","_jetpack_dont_email_post_to_subs":false,"_jetpack_newsletter_tier_id":0,"_jetpack_memberships_contains_paywalled_content":false,"_jetpack_memberships_contains_paid_content":false,"footnotes":"","jetpack_publicize_message":"","jetpack_publicize_feature_enabled":true,"jetpack_social_post_already_shared":true,"jetpack_social_options":{"image_generator_settings":{"template":"highway","enabled":false},"version":2}},"categories":[12,20,2,19,18],"tags":[],"class_list":["post-185","post","type-post","status-publish","format-standard","hentry","category-asp-net-mvc","category-bamboo","category-c","category-continuous-integration","category-powershell"],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/p6Os38-2Z","_links":{"self":[{"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/posts\/185"}],"collection":[{"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/comments?post=185"}],"version-history":[{"count":5,"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/posts\/185\/revisions"}],"predecessor-version":[{"id":618,"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/posts\/185\/revisions\/618"}],"wp:attachment":[{"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/media?parent=185"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/categories?post=185"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/langstonsoftware.com\/wp-json\/wp\/v2\/tags?post=185"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}